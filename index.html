<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“š Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.1.0/docx.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body { font-family: Tahoma, Arial; direction: rtl; margin: 20px; background: #f9f9f9; }
    h1 { color: #333; }
    .folder { border: 1px solid #ccc; padding: 10px; margin: 10px 0; background: #fff; border-radius: 8px; }
    button { margin: 5px; padding: 6px 12px; border: none; border-radius: 5px; cursor: pointer; }
    .add { background: #28a745; color: #fff; }
    .pdf { background: #6f42c1; color: #fff; }
    .word { background: #fd7e14; color: #fff; }
    .folder-btn { background: #007bff; color: #fff; }
    input { padding: 6px; border: 1px solid #ccc; border-radius: 5px; }
  </style>
</head>
<body>

  <h1>ğŸ“š Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹</h1>

  <div>
    <input id="folderName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙÙˆÙ„Ø¯Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯">
    <button class="folder-btn" onclick="createFolder()">â• Ø¥Ù†Ø´Ø§Ø¡ ÙÙˆÙ„Ø¯Ø±</button>
  </div>

  <div>
    <button class="add" onclick="addExample()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø¬Ø¹ ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¥Ù„Ù‰ (Ø¹Ø§Ù…)</button>
  </div>

  <div id="library"></div>

  <script>
    const { jsPDF } = window.jspdf;
    const { Document, Packer, Paragraph, Table, TableRow, TableCell, WidthType, TextRun } = window.docx;

    let library = { "Ø¹Ø§Ù…": [] };

    function createFolder() {
      const name = document.getElementById("folderName").value.trim();
      if (name && !library[name]) {
        library[name] = [];
        document.getElementById("folderName").value = "";
        renderLibrary();
      }
    }

    function addExample() {
      const ref = { title: "Ù…Ù†Ù‡Ø¬ÙŠØ© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ", author: "Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ", year: "2023", source: "Ø¯Ø§Ø± Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" };
      library["Ø¹Ø§Ù…"].push(ref);
      renderLibrary();
    }

    function exportPDF(folder, refs) {
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text(`Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ - ${folder}`, 14, 20);

      const rows = refs.map((r, i) => [i+1, r.title, r.author, r.year, r.source]);
      doc.autoTable({ head: [["#", "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†", "Ø§Ù„Ù…Ø¤Ù„Ù", "Ø§Ù„Ø³Ù†Ø©", "Ø§Ù„Ù…ØµØ¯Ø±"]], body: rows, startY: 30 });

      doc.save(`${folder}_references.pdf`);
    }

    async function exportWord(folder, refs) {
      const rows = refs.map((r, i) =>
        new TableRow({
          children: [
            new TableCell({ children: [new Paragraph(String(i+1))] }),
            new TableCell({ children: [new Paragraph(r.title)] }),
            new TableCell({ children: [new Paragraph(r.author)] }),
            new TableCell({ children: [new Paragraph(r.year)] }),
            new TableCell({ children: [new Paragraph(r.source)] }),
          ],
        })
      );

      const doc = new Document({
        sections: [{
          children: [
            new Paragraph({ children: [new TextRun({ text: `ğŸ“š Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ - ${folder}`, bold: true, size: 28 })] }),
            new Table({
              width: { size: 100, type: WidthType.PERCENTAGE },
              rows: [
                new TableRow({
                  children: [
                    new TableCell({ children: [new Paragraph("#")] }),
                    new TableCell({ children: [new Paragraph("Ø§Ù„Ø¹Ù†ÙˆØ§Ù†")] }),
                    new TableCell({ children: [new Paragraph("Ø§Ù„Ù…Ø¤Ù„Ù")] }),
                    new TableCell({ children: [new Paragraph("Ø§Ù„Ø³Ù†Ø©")] }),
                    new TableCell({ children: [new Paragraph("Ø§Ù„Ù…ØµØ¯Ø±")] }),
                  ]
                }),
                ...rows
              ]
            })
          ]
        }]
      });

      const blob = await Packer.toBlob(doc);
      saveAs(blob, `${folder}_references.docx`);
    }

    function renderLibrary() {
      const container = document.getElementById("library");
      container.innerHTML = "";
      Object.keys(library).forEach(folder => {
        const div = document.createElement("div");
        div.className = "folder";
        div.innerHTML = `<h3>ğŸ“‚ ${folder}</h3>`;
        const list = document.createElement("ul");
        library[folder].forEach(r => {
          const li = document.createElement("li");
          li.textContent = `${r.title} â€“ ${r.author} (${r.year})`;
          list.appendChild(li);
        });
        div.appendChild(list);
        if (library[folder].length > 0) {
          const pdfBtn = document.createElement("button");
          pdfBtn.className = "pdf";
          pdfBtn.textContent = "ğŸ“„ ØªØµØ¯ÙŠØ± PDF";
          pdfBtn.onclick = () => exportPDF(folder, library[folder]);

          const wordBtn = document.createElement("button");
          wordBtn.className = "word";
          wordBtn.textContent = "ğŸ“ ØªØµØ¯ÙŠØ± Word";
          wordBtn.onclick = () => exportWord(folder, library[folder]);

          div.appendChild(pdfBtn);
          div.appendChild(wordBtn);
        }
        container.appendChild(div);
      });
    }

    renderLibrary();
  </script>

</body>
</html>
