<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù…ÙˆÙ„Ø¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ù„Ù„Ø¨Ø§Ø­Ø«ÙŠÙ†</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      direction: rtl;
      text-align: right;
      background-color: #f9f9f9;
      color: #333;
    }
    input, select, button {
      margin: 5px 0;
      padding: 10px;
      width: 100%;
      max-width: 600px;
      box-sizing: border-box;
      font-size: 16px;
    }
    button {
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      margin-top: 5px;
    }
    button:hover { background-color: #45a049; }
    .reference {
      border: 1px solid #ddd;
      padding: 10px;
      margin-top: 10px;
      background: #fff;
      border-radius: 4px;
    }
    footer {
      margin-top: 30px;
      padding: 10px;
      text-align: center;
      font-size: 14px;
      color: #555;
      border-top: 1px solid #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    footer img { width: 50px; height: 50px; border-radius: 50%; }
    .reference a { color: #1a0dab; text-decoration: underline; }
    #suggestions {
      border: 1px solid #ccc;
      max-width: 600px;
      background: #fff;
      position: absolute;
      z-index: 10;
    }
    #suggestions div {
      padding: 8px;
      cursor: pointer;
    }
    #suggestions div:hover { background-color: #f0f0f0; }
    .autocomplete-container { position: relative; }
  </style>
</head>
<body>

<h2>ğŸ“š Ù…ÙˆÙ„Ø¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ù„Ù„Ø¨Ø§Ø­Ø«ÙŠÙ†</h2>

<div class="autocomplete-container">
  <label>Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø«:</label>
  <input type="text" id="query" placeholder="Ù…Ø«Ø§Ù„: ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø§Ø¨" oninput="showSuggestions()">
  <div id="suggestions"></div>
</div>

<label>Ø§Ø®ØªØ± ØµÙŠØºØ© Ø§Ù„ØªÙˆØ«ÙŠÙ‚:</label>
<select id="style">
  <option value="APA">APA</option>
  <option value="MLA">MLA</option>
  <option value="Chicago">Chicago</option>
</select>

<button onclick="getReference()">ğŸ” Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø±Ø¬Ø¹</button>
<button onclick="copyRef()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù…Ø±Ø¬Ø¹</button>
<button onclick="addToList()">â• Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
<button onclick="copyList()">ğŸ“‹ Ù†Ø³Ø® ÙƒÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>

<div id="result"></div>

<h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹:</h3>
<div id="refList"></div>

<button onclick="downloadWord()">â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„ ÙƒÙ…Ù„Ù Word</button>
<button onclick="clearList()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>

<!-- Footer -->
<footer>
  <img src="myphoto.jpg" alt="ØµÙˆØ±ØªÙŠ">
  <span>Â© 2025 Ù†Ø§ØµØ± Ù…Ù‡Ø±Ø§Ù†. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</span>
</footer>

<script>
let references = [];
let suggestions = [];

window.onload = function() {
  const saved = localStorage.getItem("savedReferences");
  if (saved) { references = JSON.parse(saved); renderList(); }
}

async function showSuggestions() {
  const query = document.getElementById("query").value.trim();
  const sugBox = document.getElementById("suggestions");
  sugBox.innerHTML = "";
  if(!query) return;
  try {
    const res = await fetch(`https://api.crossref.org/works?query.title=${encodeURIComponent(query)}&rows=5`);
    const json = await res.json();
    suggestions = json.message.items || [];
    suggestions.forEach(item => {
      const div = document.createElement("div");
      div.textContent = item.title ? item.title[0] : "";
      div.onclick = () => {
        document.getElementById("query").value = div.textContent;
        sugBox.innerHTML = "";
      };
      sugBox.appendChild(div);
    });
  } catch(e) { console.log("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª:", e); }
}

async function getReference() {
  const query = document.getElementById("query").value.trim();
  const style = document.getElementById("style").value;
  if(!query) return alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø«");

  let data = {title: query, authors: "", year: "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ", journal: "", volume: "", issue: "", pages: "", publisher: "", doi: ""};

  try {
    const res = await fetch(`https://api.crossref.org/works?query.title=${encodeURIComponent(query)}&rows=1`);
    const json = await res.json();
    const item = json.message.items ? json.message.items[0] : json.message;

    data.title = item.title ? item.title[0] : query;
    data.year = item.created ? item.created["date-parts"][0][0] : "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
    data.authors = item.author ? item.author.map(a => `${a.given} ${a.family}`).join(", ") : "";
    data.journal = item["container-title"] ? item["container-title"][0] : "";
    data.volume = item.volume || "";
    data.issue = item.issue || "";
    data.pages = item.page || "";
    data.publisher = item.publisher || "";
    data.doi = item.DOI ? `https://doi.org/${item.DOI}` : "";
  } catch(e) { console.log("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", e); }

  const formattedHTML = formatCitationHTML(data, style);
  document.getElementById("result").innerHTML = `<div class="reference">${formattedHTML}</div>`;
  return formattedHTML;
}

function formatCitationHTML(c, style) {
  let ref = "";
  if(style==="APA") {
    if(c.authors) ref += `${c.authors}. `;
    ref += `${c.title}. `;
    if(c.journal) ref += `${c.journal}, `;
    if(c.volume) ref += `vol. ${c.volume} `;
    if(c.issue) ref += `(${c.issue}) `;
    if(c.pages) ref += `pp. ${c.pages}. `;
    if(c.publisher) ref += `${c.publisher}. `;
    if(c.year) ref += `(${c.year}).`;
  } else if(style==="MLA") {
    if(c.authors) ref += `${c.authors}. `;
    ref += `"${c.title}." `;
    if(c.journal) ref += `${c.journal}, `;
    if(c.volume) ref += `vol. ${c.volume} `;
    if(c.issue) ref += `(${c.issue}) `;
    if(c.year) ref += `${c.year}, `;
    if(c.pages) ref += `pp. ${c.pages}. `;
    if(c.publisher) ref += `${c.publisher}. `;
  } else if(style==="Chicago") {
    if(c.authors) ref += `${c.authors}. `;
    ref += `"${c.title}." `;
    if(c.journal) ref += `${c.journal} `;
    if(c.volume) ref += `${c.volume}${c.issue ? '('+c.issue+')':''} `;
    if(c.year) ref += `(${c.year}): `;
    if(c.pages) ref += `${c.pages}. `;
    if(c.publisher) ref += `${c.publisher}. `;
  }
  if(c.doi) ref += `<br>Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØµÙˆÙ„: <a href="${c.doi}" target="_blank">${c.doi}</a>`;
  return ref;
}

function copyRef() {
  const text = document.querySelector("#result .reference")?.innerText;
  if(!text) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø±Ø¬Ø¹ Ù„Ù†Ø³Ø®Ù‡");
  navigator.clipboard.writeText(text);
  alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø±Ø¬Ø¹");
}

function addToList() {
  const htmlContent = document.querySelector("#result .reference")?.innerHTML;
  if(!htmlContent) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø±Ø¬Ø¹ Ù„Ø¥Ø¶Ø§ÙØªÙ‡");
  references.push(htmlContent);
  saveReferences();
  renderList();
}

function renderList() {
  const list = document.getElementById("refList");
  list.innerHTML = "";
  references.forEach(ref => {
    const div = document.createElement("div");
    div.className = "reference";
    div.innerHTML = ref;
    list.appendChild(div);
  });
}

function saveReferences() { localStorage.setItem("savedReferences", JSON.stringify(references)); }

function clearList() {
  if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ØŸ")){
    references=[];
    localStorage.removeItem("savedReferences");
    renderList();
    alert("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­");
  }
}

function downloadWord() {
  if(references.length===0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø§Ø¬Ø¹ Ù„Ù„ØªÙ†Ø²ÙŠÙ„");
  let content = references.join("<br><br>");
  let blob = new Blob([`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word"><body>${content}</body></html>`], {type: "application/msword"});
  let url = URL.createObjectURL(blob);
  let a=document.createElement("a");
  a.href=url;
  a.download=`Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹-${new Date().toISOString().split("T")[0]}.doc`;
  a.click();
  URL.revokeObjectURL(url);
}

function copyList() {
  if(references.length===0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø§Ø¬Ø¹ Ù„Ù†Ø³Ø®Ù‡Ø§");
  let temp = document.createElement("textarea");
  temp.value = references.map(r => r.replace(/<[^>]+>/g, '')).join("\n\n");
  document.body.appendChild(temp);
  temp.select();
  document.execCommand("copy");
  document.body.removeChild(temp);
  alert("ØªÙ… Ù†Ø³Ø® ÙƒÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹");
}
</script>
</body>
</html>
